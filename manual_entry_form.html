<!doctype html>
<html lang="ja">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>ç®¡ç†ï¼ˆæœ­å¹Œãƒ›ãƒ†ãƒ«ãƒªã‚¹ãƒˆï¼‰</title>
<style>
  body{font-family:Meiryo,'ãƒ¡ã‚¤ãƒªã‚ª',sans-serif;background:linear-gradient(145deg,#c0c0c0,#e0e0e0);margin:0;padding:14px;color:#222}
  .section-title{font-size:20px;margin:10px 0 6px;text-align:center;font-weight:bold}
  .panel{background:#fff;border:1px solid #ddd;border-radius:10px;padding:10px;margin:10px auto;max-width:1100px}
  .row{display:flex;gap:8px;flex-wrap:wrap;align-items:center}
  .row input[type="text"], .row textarea{flex:1;padding:8px;border:1px solid #bbb;border-radius:6px;font-size:16px}
  .row label{min-width:72px}
  .btn{padding:10px 14px;border-radius:10px;border:2px solid #777;background:linear-gradient(#fff,#ccc);font-weight:700;cursor:pointer}
  .btn-danger{border-color:#b44;background:linear-gradient(#fff,#f3c0c0)}
  .btn-primary{border-color:#357;background:linear-gradient(#fff,#cfe0ff)}
  .btn:disabled{opacity:.5;cursor:not-allowed}
  .grid-kana{display:grid;grid-template-columns:repeat(10,1fr);gap:6px}
  .grid-alpha{display:grid;grid-template-columns:repeat(3,1fr);gap:6px;margin-top:6px}
  .btn-k{padding:8px 0;border-radius:9999px;border:1px solid #999;background:linear-gradient(#fff,#ddd);font-weight:700;cursor:pointer}
  .btn-a{padding:8px 0;border-radius:9999px;border:1px solid #999;background:linear-gradient(#fff,#ddd);font-weight:700;cursor:pointer}
  .card{background:#fafafa;border:1px solid #ddd;border-radius:10px;padding:10px;margin-top:8px}
  .hint{font-size:12px;color:#555}
  .separator{height:1px;background:linear-gradient(90deg,transparent,#ccc,transparent);margin:10px 0}
  .controls{display:flex;gap:8px;flex-wrap:wrap;justify-content:center;margin-top:8px}
  .mini{padding:8px 10px}
  .right{display:flex;justify-content:flex-end}
  .nowrap{white-space:nowrap}
  .mono{font-family:ui-monospace, SFMono-Regular, Menlo, Consolas, "Liberation Mono", monospace}
  /* å°åˆ· */
  @page{size:A4 landscape;margin:15mm}
  @media print{
    body{background:#fff;color:#000;-webkit-print-color-adjust:exact;width:297mm;height:210mm;transform:scale(0.92);transform-origin:top left}
    .no-print{display:none !important}
    #printArea{display:block !important}
    table.print{width:100%;border-collapse:collapse}
    table.print th,table.print td{border:1px solid #000;padding:4px 6px;vertical-align:top}
    .print-title{font-size:18pt;font-weight:700;text-align:center;margin-bottom:6px}
    .print-news{margin:2px 0 4px 0}
    .page-break{page-break-after:always}
  }
  #printArea{display:none}
</style>
</head>
<body>
  <div class="panel no-print">
    <h2 class="section-title">æ–°ç€æƒ…å ±</h2>
    <div class="row">
      <label>1</label><input id="n1" type="text" placeholder="ä¾‹ï¼šğŸ†• ã‚°ãƒ©ãƒ³ãƒ‰ã‚ªãƒ¼ãƒ—ãƒ³ï¼ˆä¸­å¤®åŒºâ—‹â—‹ï¼‰">
    </div>
    <div class="row">
      <label>2</label><input id="n2" type="text" placeholder="ä¾‹ï¼šğŸ“Œ ãƒªãƒ‹ãƒ¥ãƒ¼ã‚¢ãƒ«ï¼ˆé§…å‰é€šã‚ŠåŒ—å´ï¼‰">
    </div>
    <div class="row">
      <label>3</label><input id="n3" type="text" placeholder="ä¾‹ï¼šğŸ›ˆ è‡¨æ™‚ä¼‘æ¥­ï¼ˆã€œ10/31ï¼‰">
    </div>
    <div class="right">
      <button class="btn btn-primary" onclick="applyNews()">ä¿å­˜ã—ã¦ãƒˆãƒƒãƒ—ã¸</button>
    </div>
    <div class="hint">â€» ä¿å­˜ã™ã‚‹ã¨ <span class="mono">index.html?news1=â€¦&news2=â€¦&news3=â€¦</span> ã«åæ˜ ã•ã‚Œã¾ã™ã€‚</div>
  </div>

  <div class="panel no-print">
    <h2 class="section-title">ãƒ›ãƒ†ãƒ«ç™»éŒ²ãƒ»ç·¨é›†</h2>

    <div class="grid-kana">
      <button class="btn-k" data-g="ã‚">ã‚</button><button class="btn-k" data-g="ã‹">ã‹</button>
      <button class="btn-k" data-g="ã•">ã•</button><button class="btn-k" data-g="ãŸ">ãŸ</button>
      <button class="btn-k" data-g="ãª">ãª</button><button class="btn-k" data-g="ã¯">ã¯</button>
      <button class="btn-k" data-g="ã¾">ã¾</button><button class="btn-k" data-g="ã‚„">ã‚„</button>
      <button class="btn-k" data-g="ã‚‰">ã‚‰</button><button class="btn-k" data-g="ã‚">ã‚</button>
    </div>
    <div class="grid-alpha">
      <button class="btn-a" data-g="ABCDE">ABCDE</button>
      <button class="btn-a" data-g="FGHIJ">FGHIJ</button>
      <button class="btn-a" data-g="KLMNO">KLMNO</button>
      <button class="btn-a" data-g="PQRST">PQRST</button>
      <button class="btn-a" data-g="UVWX">UVWX</button>
      <button class="btn-a" data-g="YZ">YZ</button>
    </div>

    <div id="card" class="card">
      <div class="row">
        <label>é ­æ–‡å­—</label>
        <input id="fInitial" type="text" placeholder="ã‚ / A">
        <label>ãƒ›ãƒ†ãƒ«å</label>
        <input id="fName" type="text" placeholder="ãƒ›ãƒ†ãƒ«â—¯â—¯ï¼ˆã€ãƒ›ãƒ†ãƒ«ã€ã¯æ¤œç´¢æ™‚ã«ç„¡è¦–ï¼‰">
      </div>
      <div class="row">
        <label>ä½æ‰€</label>
        <input id="fAddress" type="text" placeholder="æœ­å¹Œå¸‚â—¯â—¯åŒºâ€¦">
      </div>
      <div class="row">
        <label>å‚™è€ƒ</label>
        <textarea id="fNote" rows="3" placeholder="ä¾‹ï¼šå—2æ¡é€šåŒ—å´ã€é§…è¿‘ã€æ—§åç§°ã‚ã‚Š ãªã©"></textarea>
      </div>
      <div class="row">
        <label>ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰</label>
        <input id="fKeywords" type="text" placeholder="è‡ªå‹•ç”Ÿæˆã•ã‚Œã¾ã™ï¼ˆã‚¹ãƒšãƒ¼ã‚¹åŒºåˆ‡ã‚Šï¼‰">
        <button type="button" class="btn mini" onclick="generateKeywords()">ğŸ”§ ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰ç”Ÿæˆ</button>
      </div>

      <div class="separator"></div>
      <div class="controls">
        <button class="btn mini" id="btnPrev">â—€ å‰ã¸</button>
        <span class="nowrap">ï¼ˆ<span id="pos">0</span>/<span id="len">0</span>ï¼‰</span>
        <button class="btn mini" id="btnNext">â–¶ æ¬¡ã¸</button>

        <input id="jumpHead" class="mono" type="text" placeholder="ãƒ›ãƒ†ãƒ«åã§æ¤œç´¢" style="min-width:180px">
        <button class="btn mini" id="btnSearch">ğŸ” æ¤œç´¢</button>

        <button class="btn mini" id="btnAdd">â• è¿½åŠ ï¼ˆã“ã®å¾Œã‚ï¼‰</button>
        <button class="btn mini btn-primary" id="btnSave">ğŸ’¾ ä¿å­˜ï¼ˆå…¨ä»¶åæ˜ ï¼‰</button>
        <button class="btn mini btn-danger" id="btnDelete">ğŸ—‘ å‰Šé™¤</button>
      </div>

      <div class="hint">â€» é€ã‚Šãƒœã‚¿ãƒ³ã ã‘ã§ãªãã€ä¸Šã®äº”åéŸ³ï¼è‹±å­—ãƒœã‚¿ãƒ³ã§å¯¾è±¡ã‚°ãƒ«ãƒ¼ãƒ—ã«çµã£ã¦ã‹ã‚‰ç·¨é›†ã§ãã¾ã™ã€‚</div>
    </div>
  </div>

  <div class="panel no-print">
    <h2 class="section-title">ç®¡ç†ãƒ„ãƒ¼ãƒ«</h2>
    <div class="controls">
      <button class="btn" onclick="printAll()">ğŸ–¨ï¸ ãƒ—ãƒªãƒ³ãƒˆã‚¢ã‚¦ãƒˆ</button>
      <label class="btn" for="csvFile">ğŸ“¤ CSVã‚¤ãƒ³ãƒãƒ¼ãƒˆ</label><input id="csvFile" type="file" accept=".csv,text/csv" style="display:none">
      <button class="btn" onclick="downloadExcel()">ğŸ“¥ Excelå½¢å¼ã§ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰</button>
      <a class="btn" href="index.html">ğŸ  ãƒˆãƒƒãƒ—ã¸æˆ»ã‚‹</a>
    </div>
    <div class="hint">â€» CSVã‚¤ãƒ³ãƒãƒ¼ãƒˆå¾Œã¯è‡ªå‹•ã§å…¨ä»¶ç½®æ› â†’ GitHub Actionsä¿å­˜ã‚’è¡Œã„ã¾ã™ï¼ˆè¨­å®šæœªå®Œäº†ãªã‚‰CSVã‚’ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ä¿å­˜ï¼‰ã€‚</div>
  </div>

  <!-- å°åˆ·ç”¨ã‚¨ãƒªã‚¢ -->
  <div id="printArea"></div>

<script>
/* ====== è¨­å®šï¼šGitHub Actions é€£æºï¼ˆå¿…è¦ãªã‚‰å€¤ã‚’å…¥ã‚Œã¦æœ‰åŠ¹åŒ–ï¼‰ ====== */
const GH_OWNER = "";           // ä¾‹: "your-account"
const GH_REPO  = "";           // ä¾‹: "sapporo-hotel-list"
const GH_TOKEN = "";           // Fine-grained PATï¼ˆrepo:contentsæ¨©é™ï¼‰ã€‚ç©ºã®ã¾ã¾ãªã‚‰ãƒ­ãƒ¼ã‚«ãƒ«ä¿å­˜ã«ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯
const CSV_PATH = "data/hotels.csv";

/* ====== çŠ¶æ…‹ ====== */
let DATA_ALL = [];     // å…¨ä»¶
let VIEW = [];         // ç¾åœ¨ã®çµã‚Šè¾¼ã¿ãƒ“ãƒ¥ãƒ¼
let viewIndex = 0;     // ãƒ“ãƒ¥ãƒ¼å†…ã®ä½ç½®ï¼ˆ0-basedï¼‰
let currentGroup = null; // ç¾åœ¨æŠ¼ã•ã‚Œã¦ã„ã‚‹ã‚°ãƒ«ãƒ¼ãƒ—

/* ====== ãƒ«ãƒ¼ãƒ«ï¼ˆæ¤œç´¢ãƒ»çµè¾¼ï¼‰===== */
const KANA_RANGES = {
  'ã‚': /[ã‚ã„ã†ãˆãŠããƒã…ã‡ã‰ã‚¢ã‚¡ã‚¤ã‚£ã‚¦ã‚¥ã‚¨ã‚§ã‚ªã‚©ãƒ´]/,
  'ã‹': /[ã‹ããã‘ã“ãŒããã’ã”ã‚«ã‚­ã‚¯ã‚±ã‚³ã‚¬ã‚®ã‚°ã‚²ã‚´]/,
  'ã•': /[ã•ã—ã™ã›ãã‚µã‚·ã‚¹ã‚»ã‚½]/,
  'ãŸ': /[ãŸã¡ã¤ã¦ã¨ã ã¢ã¥ã§ã©ã‚¿ãƒãƒ„ãƒ†ãƒˆãƒ€ãƒ‚ãƒ…ãƒ‡ãƒ‰]/,
  'ãª': /[ãªã«ã¬ã­ã®ãƒŠãƒ‹ãƒŒãƒãƒ]/,
  'ã¯': /[ã¯ã²ãµã¸ã»ã°ã³ã¶ã¹ã¼ã±ã´ã·ãºã½ãƒãƒ’ãƒ•ãƒ˜ãƒ›ãƒãƒ“ãƒ–ãƒ™ãƒœãƒ‘ãƒ”ãƒ—ãƒšãƒ]/,
  'ã¾': /[ã¾ã¿ã‚€ã‚ã‚‚ãƒãƒŸãƒ ãƒ¡ãƒ¢]/,
  'ã‚„': /[ã‚„ã‚†ã‚ˆã‚ƒã‚…ã‚‡ãƒ¤ãƒ¦ãƒ¨]/,
  'ã‚‰': /[ã‚‰ã‚Šã‚‹ã‚Œã‚ãƒ©ãƒªãƒ«ãƒ¬ãƒ­]/,
  'ã‚': /[ã‚ã‚’ã‚“ãƒ¯ãƒ²ãƒ³]/
};
const ALPHA_GROUPS = {
  'ABCDE': 'ABCDE',
  'FGHIJ': 'FGHIJ',
  'KLMNO': 'KLMNO',
  'PQRST': 'PQRST',
  'UVWX': 'UVWX',
  'YZ': 'YZ'
};

/* ====== èµ·å‹• ====== */
init();
async function init(){
  await loadCSV();
  bindUI();
  applyGroup('ã‚');
}

/* ====== CSV èª­è¾¼ ====== */
async function loadCSV(){
  try{
    const r = await fetch(CSV_PATH, {cache:'no-store'});
    const t = await r.text();
    DATA_ALL = t.trim().split(/\r?\n/).filter(Boolean).map(l=>{
      const p = l.split(','); // initial,name,address,note,keywords
      return { 
        initial:(p[0]||''), 
        name:(p[1]||''), 
        address:(p[2]||''), 
        note:(p[3]||''),
        keywords:(p[4]||'')
      };
    });
  }catch(e){
    alert('CSVã®èª­ã¿è¾¼ã¿ã«å¤±æ•—ã—ã¾ã—ãŸã€‚');
    DATA_ALL = [];
  }
}

/* ====== UI ãƒã‚¤ãƒ³ãƒ‰ ====== */
function bindUI(){
  window.applyNews = function(){
    const n1 = encodeURIComponent(document.getElementById('n1').value||'');
    const n2 = encodeURIComponent(document.getElementById('n2').value||'');
    const n3 = encodeURIComponent(document.getElementById('n3').value||'');
    location.href = `index.html?news1=${n1}&news2=${n2}&news3=${n3}`;
  };

  document.querySelectorAll('[data-g]').forEach(b=>{
    b.addEventListener('click', ()=>applyGroup(b.getAttribute('data-g')));
  });

  document.getElementById('btnPrev').addEventListener('click', ()=>move(-1));
  document.getElementById('btnNext').addEventListener('click', ()=>move(1));
  document.getElementById('btnAdd').addEventListener('click', addAfter);
  document.getElementById('btnSave').addEventListener('click', saveAll);
  document.getElementById('btnDelete').addEventListener('click', delCurrent);
  document.getElementById('btnSearch').addEventListener('click', searchByName);

  document.getElementById('csvFile').addEventListener('change', onImportCSV);
  
  document.getElementById('fName').addEventListener('blur', generateKeywords);
}

/* ====== ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰è‡ªå‹•ç”Ÿæˆ ====== */
function generateKeywords() {
  const name = document.getElementById('fName').value;
  const address = document.getElementById('fAddress').value;
  
  if (!name) return;
  
  let keywords = name
    .replace(/ãƒ›ãƒ†ãƒ«/g, ' ')
    .replace(/ã€ˆ/g, ' ')
    .replace(/ã€‰/g, ' ')
    .replace(/by/g, ' ')
    .replace(/[()ï¼ˆï¼‰ãƒ»ãƒ»ãƒ»\s]/g, ' ')
    .split(/\s+/)
    .filter(word => word && word.length > 1)
    .join(' ');
  
  const addressKeywords = (address.match(/[ã-ã‚“ã‚¡-ãƒ³ä¸€-é¾ ]+?[å¸‚åŒºç”ºæ‘]/g) || [])
    .filter(addr => addr.length > 2);
  keywords += ' ' + addressKeywords.join(' ');
  
  const existingKeywords = (document.getElementById('fKeywords').value || '').split(' ').filter(k => k);
  const newKeywords = keywords.split(' ').filter(k => k);
  const allKeywords = [...new Set([...existingKeywords, ...newKeywords])].join(' ');
  
  document.getElementById('fKeywords').value = allKeywords.trim();
}

/* ====== ã‚°ãƒ«ãƒ¼ãƒ—é©ç”¨ï¼ˆäº”åéŸ³ï¼è‹±å­—ï¼‰ ====== */
function applyGroup(g){
  currentGroup = g;
  if (KANA_RANGES[g]){
    VIEW = DATA_ALL.filter(h=>{
      const head = (h.name||'').replace(/^ãƒ›ãƒ†ãƒ«\s*/,'').trim().charAt(0);
      return KANA_RANGES[g].test(head);
    });
    VIEW.sort((a,b)=> (a.name||'').localeCompare((b.name||''),'ja'));
  }else{
    const set = (ALPHA_GROUPS[g]||'');
    VIEW = DATA_ALL.filter(h=>{
      const head = ((h.name||'').replace(/^ãƒ›ãƒ†ãƒ«\s*/,'').trim().charAt(0) || '').toUpperCase();
      return set.includes(head);
    });
    VIEW.sort((a,b)=> (a.name||'').localeCompare((b.name||''),'ja'));
  }
  viewIndex = 0;
  updateForm();
}

/* ====== ãƒ•ã‚©ãƒ¼ãƒ æ›´æ–° ====== */
function updateForm(){
  const h = VIEW[viewIndex] || {};
  document.getElementById('fInitial').value = h.initial || '';
  document.getElementById('fName').value = h.name || '';
  document.getElementById('fAddress').value = h.address || '';
  document.getElementById('fNote').value = h.note || '';
  document.getElementById('fKeywords').value = h.keywords || '';
  
  document.getElementById('pos').textContent = (VIEW.length > 0 ? viewIndex + 1 : 0);
  document.getElementById('len').textContent = VIEW.length;
  
  document.getElementById('btnPrev').disabled = (viewIndex <= 0);
  document.getElementById('btnNext').disabled = (viewIndex >= VIEW.length - 1);
  document.getElementById('btnDelete').disabled = (VIEW.length === 0);
}

/* ====== ç§»å‹• ====== */
function move(delta){
  viewIndex = Math.max(0, Math.min(VIEW.length - 1, viewIndex + delta));
  updateForm();
}

/* ====== æ¤œç´¢ ====== */
function searchByName(){
  const query = document.getElementById('jumpHead').value.toLowerCase().trim();
  if(!query) return;
  
  for(let i = 0; i < VIEW.length; i++){
    if((VIEW[i].name || '').toLowerCase().includes(query)){
      viewIndex = i;
      updateForm();
      return;
    }
  }
  alert('è©²å½“ã™ã‚‹ãƒ›ãƒ†ãƒ«ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“ã§ã—ãŸ');
}

/* ====== è¿½åŠ  ====== */
function addAfter(){
  const newHotel = {
    initial: document.getElementById('fInitial').value,
    name: document.getElementById('fName').value,
    address: document.getElementById('fAddress').value,
    note: document.getElementById('fNote').value,
    keywords: document.getElementById('fKeywords').value
  };
  
  if(!newHotel.name.trim()){
    alert('ãƒ›ãƒ†ãƒ«åã¯å¿…é ˆã§ã™');
    return;
  }
  
  // ç¾åœ¨ã®ä½ç½®ã®å¾Œã‚ã«è¿½åŠ 
  const insertIndex = DATA_ALL.findIndex(h => h === VIEW[viewIndex]) + 1;
  DATA_ALL.splice(insertIndex, 0, newHotel);
  
  // ãƒ“ãƒ¥ãƒ¼ã‚’å†æ§‹ç¯‰
  applyGroup(currentGroup);
  viewIndex = VIEW.findIndex(h => h.name === newHotel.name);
  updateForm();
  alert('è¿½åŠ ã—ã¾ã—ãŸ');
}

/* ====== ä¿å­˜ ====== */
async function saveAll(){
  const csvContent = DATA_ALL.map(h => 
    [h.initial, h.name, h.address, h.note, h.keywords].map(field => 
      field || ''
    ).join(',')
  ).join('\n');
  
  try {
    if(GH_OWNER && GH_REPO && GH_TOKEN){
      await saveToGitHub(csvContent);
    }else{
      downloadCSV(csvContent, 'hotels.csv');
      alert('GitHubè¨­å®šãŒãªã„ãŸã‚ãƒ­ãƒ¼ã‚«ãƒ«ã«ä¿å­˜ã—ã¾ã—ãŸ');
    }
  }catch(e){
    downloadCSV(csvContent, 'hotels.csv');
    alert('GitHubä¿å­˜ã«å¤±æ•—ã—ãŸãŸã‚ãƒ­ãƒ¼ã‚«ãƒ«ã«ä¿å­˜ã—ã¾ã—ãŸ: ' + e.message);
  }
}

/* ====== GitHubä¿å­˜ ====== */
async function saveToGitHub(content){
  const apiUrl = `https://api.github.com/repos/${GH_OWNER}/${GH_REPO}/contents/${CSV_PATH}`;
  
  // ç¾åœ¨ã®ãƒ•ã‚¡ã‚¤ãƒ«æƒ…å ±ã‚’å–å¾—
  const currentFile = await fetch(apiUrl, {
    headers: { 'Authorization': `token ${GH_TOKEN}` }
  }).then(r => r.json());
  
  const response = await fetch(apiUrl, {
    method: 'PUT',
    headers: {
      'Authorization': `token ${GH_TOKEN}`,
      'Content-Type': 'application/json'
    },
    body: JSON.stringify({
      message: 'Update hotels data',
      content: btoa(unescape(encodeURIComponent(content))),
      sha: currentFile.sha
    })
  });
  
  if(response.ok){
    alert('GitHubã«ä¿å­˜ã—ã¾ã—ãŸ');
  }else{
    throw new Error('GitHub API error');
  }
}

/* ====== CSVãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ ====== */
function downloadCSV(content, filename){
  const blob = new Blob([content], {type: 'text/csv;charset=utf-8;'});
  const link = document.createElement('a');
  const url = URL.createObjectURL(blob);
  link.setAttribute('href', url);
  link.setAttribute('download', filename);
  link.style.visibility = 'hidden';
  document.body.appendChild(link);
  link.click();
  document.body.removeChild(link);
}

/* ====== å‰Šé™¤ ====== */
function delCurrent(){
  if(!confirm('æœ¬å½“ã«å‰Šé™¤ã—ã¾ã™ã‹ï¼Ÿ')) return;
  
  const hotelToDelete = VIEW[viewIndex];
  DATA_ALL = DATA_ALL.filter(h => h !== hotelToDelete);
  
  applyGroup(currentGroup);
  if(viewIndex >= VIEW.length) viewIndex = Math.max(0, VIEW.length - 1);
  updateForm();
  alert('å‰Šé™¤ã—ã¾ã—ãŸ');
}

/* ====== CSVã‚¤ãƒ³ãƒãƒ¼ãƒˆ ====== */
function onImportCSV(event){
  const file = event.target.files[0];
  if(!file) return;
  
  const reader = new FileReader();
  reader.onload = function(e){
    const content = e.target.result;
    const lines = content.split(/\r?\n/).filter(Boolean);
    
    DATA_ALL = lines.map(line => {
      const parts = line.split(',');
      return {
        initial: parts[0] || '',
        name: parts[1] || '',
        address: parts[2] || '',
        note: parts[3] || '',
        keywords: parts[4] || ''
      };
    });
    
    alert(`CSVã‚’ã‚¤ãƒ³ãƒãƒ¼ãƒˆã—ã¾ã—ãŸï¼ˆ${DATA_ALL.length}ä»¶ï¼‰`);
    applyGroup(currentGroup);
  };
  reader.readAsText(file);
  event.target.value = '';
}

/* ====== Excelãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ ====== */
function downloadExcel(){
  const csvContent = DATA_ALL.map(h => 
    [h.initial, h.name, h.address, h.note, h.keywords].join(',')
  ).join('\n');
  
  downloadCSV(csvContent, 'hotels_export.csv');
}

/* ====== å°åˆ· ====== */
function printAll(){
  const printArea = document.getElementById('printArea');
  let html = `
    <div class="print-title">æœ­å¹Œãƒ›ãƒ†ãƒ«ãƒªã‚¹ãƒˆ</div>
    <table class="print">
      <thead>
        <tr>
          <th>é ­æ–‡å­—</th><th>ãƒ›ãƒ†ãƒ«å</th><th>ä½æ‰€</th><th>å‚™è€ƒ</th><th>ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰</th>
        </tr>
      </thead>
      <tbody>
  `;
  
  DATA_ALL.forEach(h => {
    html += `
      <tr>
        <td>${h.initial}</td>
        <td>${h.name}</td>
        <td>${h.address}</td>
        <td>${h.note}</td>
        <td>${h.keywords}</td>
      </tr>
    `;
  });
  
  html += '</tbody></table>';
  printArea.innerHTML = html;
  window.print();
}
</script>
</body>
</html>